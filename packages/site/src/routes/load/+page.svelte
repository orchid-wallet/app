<script lang="ts">
  import {Contract, ContractFactory} from "ethers";
  import abi from '$lib/assets/abi/abi.json';
  import {web3Store} from "$lib/stores/web3";
  import {contractStore} from "$lib/stores/contracts";

  async function handleSubmit(event) {
    const data = new FormData(this);
    const walletName = data.get('wallet-name');
    const address = data.get('wallet-address');

    const contractByteCode = "608060405234801561001057600080fd5b5060405162001b1938038062001b19833981016040819052610031916100b7565b600061003b6100b3565b600080546001600160a01b0319166001600160a01b0383169081178255604051929350917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0908290a350600680546001600160a01b039092166001600160a01b031992831617905560058054909116331790556100e5565b3390565b6000602082840312156100c8578081fd5b81516001600160a01b03811681146100de578182fd5b9392505050565b611a2480620000f56000396000f3fe6080604052600436106100f75760003560e01c8063a87231141161008a578063cb0e0d7d11610059578063cb0e0d7d146102ee578063f14353261461030e578063f2fde38b1461032e578063fee207e61461034e57610137565b8063a872311414610254578063b45c0fdf14610274578063b68967e2146102a1578063c76d0845146102c157610137565b806363ec508f116100c657806363ec508f146101d8578063715018a6146101fa5780638da5cb5b1461020f57806396bf47411461022457610137565b80630562b9f71461013c57806312065fe01461015e5780632a2d0c471461018957806337ba9523146101b657610137565b36610137577f88a5966d370b9919b20f3e2c13ff65706f196a4e32cc2c12bf57088f88525874333460405161012d929190611555565b60405180910390a1005b600080fd5b34801561014857600080fd5b5061015c6101573660046111ef565b61036e565b005b34801561016a57600080fd5b5061017361043f565b60405161018091906118e4565b60405180910390f35b34801561019557600080fd5b506101a96101a43660046111ef565b610443565b6040516101809190611541565b3480156101c257600080fd5b506101cb61045e565b6040516101809190611659565b3480156101e457600080fd5b506101ed6104e8565b604051610180919061191c565b34801561020657600080fd5b5061015c6104ed565b34801561021b57600080fd5b506101a9610576565b34801561023057600080fd5b5061024461023f36600461121f565b610585565b60405161018094939291906118ed565b34801561026057600080fd5b506101a961026f36600461121f565b610638565b34801561028057600080fd5b5061029461028f36600461119b565b610653565b60405161018091906116a6565b3480156102ad57600080fd5b506102946102bc366004611239565b610673565b3480156102cd57600080fd5b506102e16102dc36600461121f565b610831565b6040516101809190611884565b3480156102fa57600080fd5b50610173610309366004611178565b610962565b34801561031a57600080fd5b506101ed6103293660046111ef565b610974565b34801561033a57600080fd5b5061015c610349366004611178565b6109b1565b34801561035a57600080fd5b50610294610369366004611312565b610a71565b610376610c31565b6001600160a01b0316610387610576565b6001600160a01b0316146103b65760405162461bcd60e51b81526004016103ad9061177a565b60405180910390fd5b6103be61043f565b8111156103ca57600080fd5b6005546040516001600160a01b039091169082156108fc029083906000818181858888f19350505050158015610404573d6000803e3d6000fd5b507f248dd4076d0a389d795107efafd558ce7f31ae37b441ccb9a599c60868f480d58160405161043491906118e4565b60405180910390a150565b4790565b6007602052600090815260409020546001600160a01b031681565b606060048054806020026020016040519081016040528092919081815260200182805480156104de57602002820191906000526020600020906000905b82829054906101000a90046001600160401b03166001600160401b03168152602001906008019060208260070104928301926001038202915080841161049b5790505b5050505050905090565b600181565b6104f5610c31565b6001600160a01b0316610506610576565b6001600160a01b03161461052c5760405162461bcd60e51b81526004016103ad9061177a565b600080546040516001600160a01b03909116907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0908390a3600080546001600160a01b0319169055565b6000546001600160a01b031690565b6002602081905260009182526040909120805460018201549282015460048301805492949391926105b590611985565b80601f01602080910402602001604051908101604052809291908181526020018280546105e190611985565b801561062e5780601f106106035761010080835404028352916020019161062e565b820191906000526020600020905b81548152906001019060200180831161061157829003601f168201915b5050505050905084565b6003602052600090815260409020546001600160a01b031681565b600160209081526000928352604080842090915290825290205460ff1681565b6001600160401b0385166000908152600360205260408120546001600160a01b03166106b15760405162461bcd60e51b81526004016103ad906117f8565b6001600160401b0386166000908152600260205260409020546106e65760405162461bcd60e51b81526004016103ad90611840565b6001600160401b03861660009081526003602052604090205461071590879087906001600160a01b0316610c35565b6001600160401b03861660009081526003602090815260408083205460029092529182902091516319f8754160e21b81526001600160a01b03909116916367e1d5049161076d9189918991899189919060040161156e565b60206040518083038186803b15801561078557600080fd5b505afa158015610799573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906107bd91906111cf565b6107d95760405162461bcd60e51b81526004016103ad90611743565b3360009081526001602081815260408084206001600160401b038b1685528252808420805460ff19169093179092556003905290205461082590879087906001600160a01b0316610d17565b50600195945050505050565b610839610f00565b6001600160401b038216600090815260026020818152604092839020835160a0810185528154815260018201548184015292810154838501526003810180548551818502810185019096528086529394919360608601938301828280156108bf57602002820191906000526020600020905b8154815260200190600101908083116108ab575b505050505081526020016004820180546108d890611985565b80601f016020809104026020016040519081016040528092919081815260200182805461090490611985565b80156109515780601f1061092657610100808354040283529160200191610951565b820191906000526020600020905b81548152906001019060200180831161093457829003601f168201915b50505050508152505090505b919050565b60086020526000908152604090205481565b6004818154811061098457600080fd5b9060005260206000209060049182820401919006600802915054906101000a90046001600160401b031681565b6109b9610c31565b6001600160a01b03166109ca610576565b6001600160a01b0316146109f05760405162461bcd60e51b81526004016103ad9061177a565b6001600160a01b038116610a165760405162461bcd60e51b81526004016103ad906116b1565b600080546040516001600160a01b03808516939216917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e091a3600080546001600160a01b0319166001600160a01b0392909216919091179055565b6000610a7b610c31565b6001600160a01b0316610a8c610576565b6001600160a01b031614610ab25760405162461bcd60e51b81526004016103ad9061177a565b6001600160401b0384166000908152600360205260409020546001600160a01b0316610b36576004805460018101825560008290529081047f8a35acfbc15ff81a39ae7d344fd709f28e8600b4aa8c65c6b64bfe7fe36bd19b0180546001600160401b0380881660086003909516949094026101000a938402930219169190911790555b60608201516001600160401b03851660009081526002602090815260409091208251610b6b9360039092019290910190610f2f565b506040808301516001600160401b038616600090815260026020818152939091209081019190915560808401518051610bae936004909301929190910190610f7a565b506020808301516001600160401b0386166000908152600283526040902060018101919091558351815560808401518051610bf3936004909301929190910190610f7a565b50506001600160401b038316600090815260036020526040902080546001600160a01b0384166001600160a01b031990911617905560019392505050565b3390565b6000610cd783836001600160a01b0316639f442afa6040518163ffffffff1660e01b815260040160206040518083038186803b158015610c7457600080fd5b505afa158015610c88573d6000803e3d6000fd5b505050506040513d601f19601f82011682018060405250810190610cac9190611207565b81518110610cca57634e487b7160e01b600052603260045260246000fd5b6020026020010151610d74565b9050806001600160a01b0316610ceb610c31565b6001600160a01b031614610d115760405162461bcd60e51b81526004016103ad906116f7565b50505050565b6001600160401b0383166001148015610d53575060086000610d37610c31565b6001600160a01b03168152602081019190915260400160002054155b610d6f5760405162461bcd60e51b81526004016103ad906117af565b505050565b6000610d8f610d8a610d8584610d95565b610ecf565b610ef9565b92915050565b600881811c7eff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff167fff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff00ff009290911b9190911617601081811c7dffff0000ffff0000ffff0000ffff0000ffff0000ffff0000ffff0000ffff167fffff0000ffff0000ffff0000ffff0000ffff0000ffff0000ffff0000ffff00009290911b9190911617602081811c7bffffffff00000000ffffffff00000000ffffffff00000000ffffffff167fffffffff00000000ffffffff00000000ffffffff00000000ffffffff000000009290911b9190911617604081811c77ffffffffffffffff0000000000000000ffffffffffffffff1677ffffffffffffffff0000000000000000ffffffffffffffff199290911b9190911617608081811c91901b1790565b60408051602080825281830190925260609160208201818036833750505060208101929092525090565b6014015190565b6040518060a0016040528060008152602001600081526020016000815260200160608152602001606081525090565b828054828255906000526020600020908101928215610f6a579160200282015b82811115610f6a578251825591602001919060010190610f4f565b50610f76929150610fed565b5090565b828054610f8690611985565b90600052602060002090601f016020900481019282610fa85760008555610f6a565b82601f10610fc157805160ff1916838001178555610f6a565b82800160010185558215610f6a5791820182811115610f6a578251825591602001919060010190610f4f565b5b80821115610f765760008155600101610fee565b600082601f830112611012578081fd5b604051604081018181106001600160401b0382111715611034576110346119c0565b806040525080838560408601111561104a578384fd5b835b600281101561106b57813583526020928301929091019060010161104c565b509195945050505050565b600082601f830112611086578081fd5b813560206001600160401b038211156110a1576110a16119c0565b8082026110af828201611930565b8381528281019086840183880185018910156110c9578687fd5b8693505b858410156110eb5780358352600193909301929184019184016110cd565b50979650505050505050565b600082601f830112611107578081fd5b81356001600160401b03811115611120576111206119c0565b611133601f8201601f1916602001611930565b818152846020838601011115611147578283fd5b816020850160208301379081016020019190915292915050565b80356001600160401b038116811461095d57600080fd5b600060208284031215611189578081fd5b8135611194816119d6565b9392505050565b600080604083850312156111ad578081fd5b82356111b8816119d6565b91506111c660208401611161565b90509250929050565b6000602082840312156111e0578081fd5b81518015158114611194578182fd5b600060208284031215611200578081fd5b5035919050565b600060208284031215611218578081fd5b5051919050565b600060208284031215611230578081fd5b61119482611161565b60008060008060006101408688031215611251578081fd5b61125a86611161565b94506020808701356001600160401b03811115611275578283fd5b61128189828a01611076565b955050604061129289828a01611002565b945088609f8901126112a2578283fd5b60026112b56112b082611959565b611930565b8060808b016101008c018d8111156112cb578788fd5b875b858110156112f1576112df8f84611002565b855293870193918601916001016112cd565b508298506112ff8e82611002565b9750505050505050509295509295909350565b600080600060608486031215611326578283fd5b61132f84611161565b9250602084013561133f816119d6565b915060408401356001600160401b038082111561135a578283fd5b9085019060a0828803121561136d578283fd5b60405160a081018181108382111715611388576113886119c0565b80604052508235815260208301356020820152604083013560408201526060830135828111156113b6578485fd5b6113c289828601611076565b6060830152506080830135828111156113d9578485fd5b6113e5898286016110f7565b6080830152508093505050509250925092565b8060005b6002811015610d115781518452602093840193909101906001016113fc565b6000815180845260208085019450808401835b8381101561144a5781518752958201959082019060010161142e565b509495945050505050565b60008151808452815b8181101561147a5760208185018101518683018201520161145e565b8181111561148b5782602083870101525b50601f01601f19169290920160200192915050565b8054600090600281046001808316806114ba57607f831692505b60208084108214156114da57634e487b7160e01b86526022600452602486fd5b6114e484896118e4565b8280156114f8576001811461150957611534565b60ff19871682528282019750611534565b61151289611979565b60005b8781101561152e57815484820152908601908401611515565b83019850505b5050505050505092915050565b6001600160a01b0391909116815260200190565b6001600160a01b03929092168252602082015260400190565b60006101408083526115828184018961141b565b90506020611592818501896113f8565b6060840187845b60028110156115c0576115ad8383516113f8565b6040929092019190830190600101611599565b5050506115d060e08501876113f8565b83820361012085015284548252600180860154828401526002860154604084015260a06060840181905260038701805491850182905285528285209190859060c08601905b808310156116325784548252938301939183019190850190611615565b5085810360808701526116488160048b016114a0565b9d9c50505050505050505050505050565b6020808252825182820181905260009190848201906040850190845b8181101561169a5783516001600160401b031683529284019291840191600101611675565b50909695505050505050565b901515815260200190565b60208082526026908201527f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160408201526564647265737360d01b606082015260800190565b6020808252602c908201527f6164647265737320696e207468652070726f6f66206973206e6f74206120736560408201526b6e646572206164647265737360a01b606082015260800190565b6020808252601b908201527f70726f6f6620726573706f6e7365206973206e6f742076616c69640000000000604082015260600190565b6020808252818101527f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572604082015260600190565b60208082526029908201527f70726f6f662063616e206e6f74206265207375626d6974746564206d6f7265206040820152687468616e206f6e636560b81b606082015260800190565b60208082526028908201527f76616c696461746f72206973206e6f742073657420666f7220746869732072656040820152671c5d595cdd081a5960c21b606082015260800190565b60208082526024908201527f7175657279206973206e6f742073657420666f722074686973207265717565736040820152631d081a5960e21b606082015260800190565b600060208252825160208301526020830151604083015260408301516060830152606083015160a060808401526118be60c084018261141b565b90506080840151601f198483030160a08501526118db8282611455565b95945050505050565b90815260200190565b6000858252846020830152836040830152608060608301526119126080830184611455565b9695505050505050565b6001600160401b0391909116815260200190565b6040518181016001600160401b0381118282101715611951576119516119c0565b604052919050565b60006001600160401b03821115611972576119726119c0565b5060200290565b60009081526020902090565b60028104600182168061199957607f821691505b602082108114156119ba57634e487b7160e01b600052602260045260246000fd5b50919050565b634e487b7160e01b600052604160045260246000fd5b6001600160a01b03811681146119eb57600080fd5b5056fea264697066735822122012356a1231c2cfcdbcd3ed93fec6ceb09e56ca18db25bf83ac1ceb963c01956b64736f6c63430008000033"

    const factory = new ContractFactory(abi, contractByteCode, web3Store.signer);
    // If your contract requires constructor args, you can specify them here
    const contract = await factory.connect(address);

    contractStore.updateData(contract as any, walletName as string);

    console.log(contract.address);
    console.log(contract.deployTransaction);
  }
</script>

<div class="mx-auto py-8 max-w-7xl sm:px-6 lg:px-8">
  <div class="lg:grid lg:grid-cols-12 lg:gap-x-5">
    <aside class="py-6 px-2 sm:px-6 lg:col-span-3 lg:py-0 lg:px-0">
      <nav class="space-y-1">
        <a href="#" class="bg-gray-50 text-indigo-700 hover:text-indigo-700 hover:bg-white group rounded-md px-3 py-2 flex items-center text-sm font-medium" aria-current="page">
          <svg class="text-indigo-500 group-hover:text-indigo-500 flex-shrink-0 -ml-1 mr-3 h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true">
            <path stroke-linecap="round" stroke-linejoin="round" d="M17.982 18.725A7.488 7.488 0 0012 15.75a7.488 7.488 0 00-5.982 2.975m11.963 0a9 9 0 10-11.963 0m11.963 0A8.966 8.966 0 0112 21a8.966 8.966 0 01-5.982-2.275M15 9.75a3 3 0 11-6 0 3 3 0 016 0z" />
          </svg>
          <span class="truncate">Load Existing Wallet</span>
        </a>
      </nav>
    </aside>

    <div class="space-y-6 sm:px-6 lg:col-span-9 lg:px-0">

      <form method="POST">
        <div class="shadow sm:overflow-hidden sm:rounded-md">
          <div class="space-y-6 bg-white py-6 px-4 sm:p-6">
            <div>
              <h3 class="text-lg font-medium leading-6 text-gray-900">Load Existing Wallet</h3>
              <p class="mt-1 text-sm text-gray-500">If you already created a Smart Wallet that is controlled by you. You can recover it here.</p>
            </div>

            <div class="grid grid-cols-6 gap-6">

              <div class="col-span-6 sm:col-span-4">
                <label for="wallet-name" class="block text-sm font-medium text-gray-700">Wallet Name</label>
                <input type="text" name="wallet-name" id="wallet-name" class="mt-1 block w-full rounded-md border border-gray-300 py-2 px-3 shadow-sm focus:border-indigo-500 focus:outline-none focus:ring-indigo-500 sm:text-sm">
              </div>

              <div class="col-span-6 sm:col-span-4">
                <label for="wallet-address" class="block text-sm font-medium text-gray-700">Wallet Address</label>
                <input type="text" name="wallet-address" id="wallet-address" class="mt-1 block w-full rounded-md border border-gray-300 py-2 px-3 shadow-sm focus:border-indigo-500 focus:outline-none focus:ring-indigo-500 sm:text-sm">
              </div>

            </div>
          </div>
          <div class="bg-gray-50 px-4 py-3 text-right sm:px-6">
            <button type="submit" class="inline-flex justify-center rounded-md border border-transparent bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
                    on:click={async () => {
            console.log('deploy contract')
          }}>Load Wallet</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
